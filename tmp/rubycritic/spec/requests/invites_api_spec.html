<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../assets/vendor/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/vendor/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/vendor/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../overview.html"><img src="../../assets/images/logo.png" alt="Ruby Critic Logo" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
      
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
          <li class="sidebar-item">
            <a href="../../simple_cov_index.html" class="project-nav-item coverage-index-nav"><i class="fa fa-umbrella"></i>Coverage</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Updated <time class='js-timeago' datetime='2021-09-22 16:27:07 -0300'>2021-09-22 16:27:07 -0300</time>
        
      </span>
    </div>
    <div>
      <h3><small>spec/requests /</small> invites_api_spec.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">520</span><small> lines of codes</small></div>
              <div><span class="metric">1</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">1997.8</span><small> complexity/method</small></div>
              <div><span class="metric">17</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">1997.79</span><small> complexity</small></div>
              <div><span class="metric">528</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                31
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code">require &#39;spec_helper&#39;

describe &#39;Invite API&#39; do
  def app
    Sinatra::Application
  end

  let(:user) { create(:user) }

  context &#39;GET /v1/invites&#39; do
    it &#39;User see all your invites&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(GET /v1/invites)::it#User see all your invites has a flog score of 236</span>          </div>  </li></ol>
      sender = create(:user)
      event1 = create(:event, owner_id: sender.id)
      event2 = create(:event, owner_id: sender.id)
      event3 = create(:event, owner_id: sender.id)
      invite = create(:invite, sender_id: sender.id, receiver_id: user.id, event_id: event1.id)
      invite2 = create(:invite, sender_id: sender.id, receiver_id: user.id, event_id: event2.id)
      invite3 = create(:invite, sender_id: sender.id, receiver_id: user.id, event_id: event3.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      get &#39;v1/invites&#39;

      expect(last_response.status).to eq 200
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[0][&#39;token&#39;]).to eq(invite.token)
      expect(parsed_body[0][&#39;event_name&#39;]).to eq(event1.name)
      expect(parsed_body[0][&#39;event_start_date&#39;]).to eq(event1.start_date.to_s)
      expect(parsed_body[0][&#39;event_end_date&#39;]).to eq(event1.end_date.to_s)
      expect(parsed_body[0][&#39;sender_name&#39;]).to eq(sender.name)

      expect(parsed_body[1][&#39;token&#39;]).to eq(invite2.token)
      expect(parsed_body[1][&#39;event_name&#39;]).to eq(event2.name)
      expect(parsed_body[1][&#39;event_start_date&#39;]).to eq(event2.start_date.to_s)
      expect(parsed_body[1][&#39;event_end_date&#39;]).to eq(event2.end_date.to_s)
      expect(parsed_body[1][&#39;sender_name&#39;]).to eq(sender.name)

      expect(parsed_body[2][&#39;token&#39;]).to eq(invite3.token)
      expect(parsed_body[2][&#39;event_name&#39;]).to eq(event3.name)
      expect(parsed_body[2][&#39;event_start_date&#39;]).to eq(event3.start_date.to_s)
      expect(parsed_body[2][&#39;event_end_date&#39;]).to eq(event3.end_date.to_s)
      expect(parsed_body[2][&#39;sender_name&#39;]).to eq(sender.name)
    end

    it &quot;Get empty array if don&#39;t have any invite&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(GET /v1/invites)::it#Get empty array if don't have any invite has a flog score of 36</span>          </div>  </li></ol>
      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      get &#39;v1/invites&#39;

      expect(last_response.status).to eq 200
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body).to eq([])
    end
  end

  context &#39;GET /v1/invites/:token&#39; do
    it &#39;successufuly see an invite&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(GET /v1/invites/:token)::it#successufuly see an invite has a flog score of 90</span>          </div>  </li></ol>
      sender = create(:user)
      event = create(:event, owner_id: sender.id)
      invite = create(:invite, sender_id: sender.id, receiver_id: user.id, event_id: event.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      get &quot;v1/invites/#{invite.token}&quot;

      expect(last_response.status).to eq 200
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[&#39;token&#39;]).to eq(invite.token)
      expect(parsed_body[&#39;event_name&#39;]).to eq(event.name)
      expect(parsed_body[&#39;event_start_date&#39;]).to eq(event.start_date.to_s)
      expect(parsed_body[&#39;event_end_date&#39;]).to eq(event.end_date.to_s)
      expect(parsed_body[&#39;sender_name&#39;]).to eq(sender.name)
    end

    it &#39;only sender and receiver can see invite&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(GET /v1/invites/:token)::it#only sender and receiver can see invite has a flog score of 40</span>          </div>  </li></ol>
      receiver = create(:user)
      sender = create(:user)
      event = create(:event, owner_id: sender.id)
      invite = create(:invite, sender_id: sender.id, receiver_id: receiver.id, event_id: event.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      get &quot;v1/invites/#{invite.token}&quot;

      expect(last_response.status).to eq 403
      expect(last_response.content_type).to include(&#39;application/json&#39;)
    end

    it &#39;non existent invite&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="events_api_spec.html#L65" class="js-smell-location">0</a>                  <a href="invites_api_spec.html#L94" class="js-smell-location">1</a>                  <a href="invites_api_spec.html#L513" class="js-smell-location">2</a>                  </div>  </li></ol>
      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      get &quot;v1/invites/#{rand(1.10000)}&quot;

      expect(last_response.status).to eq 404
    end
  end

  context &#39;POST /v1/events/:event_id/invite&#39; do
    it &#39;create an invite with email&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#create an invite with email has a flog score of 97</span>          </div>  </li></ol>
      reciver = create(:user)
      event = create(:event, owner_id: user.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &quot;/v1/events/#{event.id}/invite&quot;, { users_emails: [reciver.email] }.to_json,
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;
      expect(last_response.status).to eq 201
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[0][&#39;event_name&#39;]).to eq(event.name)
      expect(parsed_body[0][&#39;sender_name&#39;]).to eq(user.name)
      expect(Invite.last.receiver_id).to eq(reciver.id)
      expect(Invite.last.sender_id).to eq(user.id)
      expect(Invite.last.event_id).to eq(event.id)
    end

    it &#39;create an invite with user id&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#create an invite with user id has a flog score of 97</span>          </div>  </li></ol>
      reciver = create(:user)
      event = create(:event, owner_id: user.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &quot;/v1/events/#{event.id}/invite&quot;, { user_id: reciver.id }.to_json,
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;

      expect(last_response.status).to eq 201
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      parsed_body = JSON.parse(last_response.body)
      expect(parsed_body[0][&#39;event_name&#39;]).to eq(event.name)
      expect(parsed_body[0][&#39;sender_name&#39;]).to eq(user.name)
      expect(Invite.last.receiver_id).to eq(reciver.id)
      expect(Invite.last.sender_id).to eq(user.id)
      expect(Invite.last.event_id).to eq(event.id)
    end

    it &#39;create multiples invites with an array of emails&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#create multiples invites with an array of emails has a flog score of 65</span>          </div>  </li></ol>
      reciver = create(:user)
      reciver2 = create(:user)
      reciver3 = create(:user)
      event = create(:event, owner_id: user.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &quot;/v1/events/#{event.id}/invite&quot;, { users_emails: [reciver.email, reciver2.email, reciver3.email] }.to_json,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="invites_api_spec.html#L148" class="js-smell-location">0</a>                  <a href="invites_api_spec.html#L192" class="js-smell-location">1</a>                  </div>  </li></ol>
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;

      expect(last_response.status).to eq 201
      expect(last_response.content_type).to include(&#39;application/json&#39;)
      expect(Invite.find_by(receiver_id: reciver2.id).event).to eq(event)
      expect(Invite.find_by(receiver_id: reciver3.id).event).to eq(event)
    end

    it &#39;not json body&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#not json body has a flog score of 44</span>          </div>  </li></ol>
      event = create(:event, owner_id: user.id)
      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &quot;/v1/events/#{event.id}/invite&quot;, {},
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;

      expect(last_response.status).to eq 400
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[&#39;error&#39;]).to eq(&#39;Please send JSON for the API&#39;)
    end

    it &quot;can&#39;t create invite if event day already passed&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#can't create invite if event day already passed has a flog score of 52</span>          </div>  </li></ol>
      reciver = create(:user)
      event = create(:event, owner_id: user.id, start_date: 2.days.ago, end_date: 1.day.ago)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &quot;/v1/events/#{event.id}/invite&quot;, { users_emails: [reciver.email] }.to_json,
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;

      expect(last_response.status).to eq 400
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      expect(Invite.all).to eq([])
    end

    it &quot;can&#39;t create multiple invites if event already passed&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#can't create multiple invites if event already passed has a flog score of 48</span>          </div>  </li></ol>
      reciver = create(:user)
      reciver2 = create(:user)
      reciver3 = create(:user)
      event = create(:event, owner_id: user.id, start_date: 2.days.ago, end_date: 1.day.ago)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &quot;/v1/events/#{event.id}/invite&quot;, { users_emails: [reciver.email, reciver2.email, reciver3.email] }.to_json,<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Identical code found in 2 nodes</span>              <span>Locations:</span>                  <a href="invites_api_spec.html#L148" class="js-smell-location">0</a>                  <a href="invites_api_spec.html#L192" class="js-smell-location">1</a>                  </div>  </li></ol>
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;

      expect(last_response.status).to eq 400

      expect(Invite.all).to eq([])
    end

    it &quot;can&#39;t invite user if user already invited&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#can't invite user if user already invited has a flog score of 47</span>          </div>  </li></ol>
      reciver = create(:user)
      event = create(:event, owner_id: user.id)
      first_sender = create(:user)

      create(:invite, receiver_id: reciver.id, sender_id: first_sender.id, event_id: event.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &quot;/v1/events/#{event.id}/invite&quot;, { users_emails: [reciver.email] }.to_json,
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;

      expect(last_response.status).to eq 400

      parsed_body = JSON.parse(last_response.body)
      expect(parsed_body[&#39;error&#39;]).to eq(&#39;User already invited&#39;)
    end

    it &#39;user not found from email&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#user not found from email has a flog score of 36</span>          </div>  </li></ol>
      event = create(:event, owner_id: user.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &quot;/v1/events/#{event.id}/invite&quot;, { users_emails: [&#39;email@gmail.com&#39;] }.to_json,
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;

      expect(last_response.status).to eq 400

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[&#39;error&#39;]).to eq(&quot;Couldn&#39;t find User with this email&quot;)
    end

    it &#39;user not found from id&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#user not found from id has a flog score of 36</span>          </div>  </li></ol>
      event = create(:event, owner_id: user.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &quot;/v1/events/#{event.id}/invite&quot;, { user_id: 1234 }.to_json,
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;

      expect(last_response.status).to eq 400

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[&#39;error&#39;]).to eq(&quot;Couldn&#39;t find User with &#39;id&#39;=1234&quot;)
    end

    it &#39;non existent event&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#non existent event has a flog score of 32</span>          </div>  </li></ol>
      reciver = create(:user)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &#39;/v1/events/32145/invite&#39;, { user_id: reciver.id }.to_json,
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;

      expect(last_response.status).to eq 404

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[&#39;error&#39;]).to eq(&#39;Event not found&#39;)
    end

    it &#39;sending ID and Email&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#sending ID and Email has a flog score of 41</span>          </div>  </li></ol>
      reciver = create(:user)
      event = create(:event, owner_id: user.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &quot;/v1/events/#{event.id}/invite&quot;, { users_emails: [reciver.email], user_id: reciver.id }.to_json,
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;

      expect(last_response.status).to eq 400

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[&#39;error&#39;]).to eq(&#39;Send email or the ID from the user, but not both&#39;)
    end

    it &quot;cant&#39;t invite owner of the event&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#cant't invite owner of the event has a flog score of 39</span>          </div>  </li></ol>
      event = create(:event, owner_id: user.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &quot;/v1/events/#{event.id}/invite&quot;, { users_emails: [user.email] }.to_json,
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;

      expect(last_response.status).to eq 400

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[&#39;error&#39;]).to eq(&#39;User alredy invited&#39;)
    end

    it &quot;user cant&#39;t invite himself&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(POST /v1/events/:event_id/invite)::it#user cant't invite himself has a flog score of 48</span>          </div>  </li></ol>
      owner = create(:user)
      event = create(:event, owner_id: owner.id)
      create(:invite, event_id: event.id, sender_id: owner.id, receiver_id: user.id, status: 1)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      post &quot;/v1/events/#{event.id}/invite&quot;, { users_emails: [user.email] }.to_json,
           &#39;CONTENT_TYPE&#39; =&gt; &#39;application/json&#39;

      expect(last_response.status).to eq 400

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[&#39;error&#39;]).to eq(&#39;User already invited&#39;)
    end
  end

  context &#39;PUT /v1/invites/:token/accept&#39; do
    it &#39;accept invite&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(PUT /v1/invites/:token/accept)::it#accept invite has a flog score of 46</span>          </div>  </li></ol>
      sender = create(:user)
      invite = create(:invite, receiver_id: user.id, sender_id: sender.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      put &quot;/v1/invites/#{invite.token}/accept&quot;

      expect(last_response.status).to eq 200
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      expect(Invite.find(invite.id).status).to eq(&#39;accepted&#39;)
    end

    it &#39;see user on participants event list&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(PUT /v1/invites/:token/accept)::it#see user on participants event list has a flog score of 227</span>          </div>  </li></ol>
      reciver = create(:user)
      reciver2 = create(:user)
      reciver3 = create(:user)
      event = create(:event, owner_id: user.id)
      create(:invite, receiver_id: reciver.id, event_id: event.id, sender_id: user.id, status: 1)
      create(:invite, receiver_id: reciver2.id, event_id: event.id, sender_id: user.id, status: 1)
      create(:invite, receiver_id: reciver3.id, event_id: event.id, sender_id: user.id, status: 1)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      get &quot;/v1/events/#{event.id}&quot;

      expect(last_response.status).to eq 200
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[&#39;participants&#39;][0][&#39;name&#39;]).to eq(user.name)
      expect(parsed_body[&#39;participants&#39;][0][&#39;id&#39;]).to eq(user.id)
      expect(parsed_body[&#39;participants&#39;][0][&#39;email&#39;]).to eq(user.email)

      expect(parsed_body[&#39;participants&#39;][1][&#39;name&#39;]).to eq(reciver.name)
      expect(parsed_body[&#39;participants&#39;][1][&#39;id&#39;]).to eq(reciver.id)
      expect(parsed_body[&#39;participants&#39;][1][&#39;email&#39;]).to eq(reciver.email)

      expect(parsed_body[&#39;participants&#39;][2][&#39;name&#39;]).to eq(reciver2.name)
      expect(parsed_body[&#39;participants&#39;][2][&#39;id&#39;]).to eq(reciver2.id)
      expect(parsed_body[&#39;participants&#39;][2][&#39;email&#39;]).to eq(reciver2.email)

      expect(parsed_body[&#39;participants&#39;][3][&#39;name&#39;]).to eq(reciver3.name)
      expect(parsed_body[&#39;participants&#39;][3][&#39;id&#39;]).to eq(reciver3.id)
      expect(parsed_body[&#39;participants&#39;][3][&#39;email&#39;]).to eq(reciver3.email)
    end

    it &quot;can&#39;t accept invite if event day already passed&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(PUT /v1/invites/:token/accept)::it#can't accept invite if event day already passed has a flog score of 68</span>          </div>  </li></ol>
      sender = create(:user)
      event = create(:event, owner_id: sender.id, start_date: 2.days.ago, end_date: 1.day.ago)
      invite = create(:invite, event_id: event.id, sender_id: sender.id, receiver_id: user.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      put &quot;/v1/invites/#{invite.token}/accept&quot;

      expect(last_response.status).to eq 400
      expect(last_response.content_type).to include(&#39;application/json&#39;)
      expect(Invite.last.status).to eq(&#39;unanswered&#39;)

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[&#39;error&#39;]).to eq(&#39;Event day already passed&#39;)
    end

    it &#39;possible change status after already had one&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(PUT /v1/invites/:token/accept)::it#possible change status after already had one has a flog score of 69</span>          </div>  </li></ol>
      sender = create(:user)
      invite = create(:invite, receiver_id: user.id, sender_id: sender.id, status: 2)

      expect(invite.status).to eq(&#39;refused&#39;)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      put &quot;/v1/invites/#{invite.token}/accept&quot;

      expect(last_response.status).to eq 200
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      expect(Invite.find(invite.id).status).to eq(&#39;accepted&#39;)
      expect(EventSerializer.new(invite.event).response[:participants].count).to eq(2)
    end
    it &#39;non existent invite&#39; do
      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      put &quot;v1/invites/#{rand(1.10000)}/accept&quot;

      expect(last_response.status).to eq 404
    end
  end

  context &#39;PUT /v1/invites/:token/refuse&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="invites_api_spec.html#L393" class="js-smell-location">0</a>                  <a href="invites_api_spec.html#L447" class="js-smell-location">1</a>                  </div>  </li></ol>
    it &#39;refuse invite&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(PUT /v1/invites/:token/refuse)::it#refuse invite has a flog score of 46</span>          </div>  </li></ol>
      sender = create(:user)
      invite = create(:invite, receiver_id: user.id, sender_id: sender.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      put &quot;/v1/invites/#{invite.token}/refuse&quot;

      expect(last_response.status).to eq 200
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      expect(Invite.find(invite.id).status).to eq(&#39;refused&#39;)
    end

    it &quot;can&#39;t refuse invite if event day already passed&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(PUT /v1/invites/:token/refuse)::it#can't refuse invite if event day already passed has a flog score of 68</span>          </div>  </li></ol>
      sender = create(:user)
      event = create(:event, owner_id: sender.id, start_date: 2.days.ago, end_date: 1.day.ago)
      invite = create(:invite, event_id: event.id, sender_id: sender.id, receiver_id: user.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      put &quot;/v1/invites/#{invite.token}/refuse&quot;

      expect(last_response.status).to eq 400
      expect(last_response.content_type).to include(&#39;application/json&#39;)
      expect(Invite.last.status).to eq(&#39;unanswered&#39;)

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[&#39;error&#39;]).to eq(&#39;Event day already passed&#39;)
    end

    it &#39;possible change status after already had one&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(PUT /v1/invites/:token/refuse)::it#possible change status after already had one has a flog score of 69</span>          </div>  </li></ol>
      sender = create(:user)
      invite = create(:invite, receiver_id: user.id, sender_id: sender.id, status: 1)

      expect(invite.status).to eq(&#39;accepted&#39;)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      put &quot;/v1/invites/#{invite.token}/refuse&quot;

      expect(last_response.status).to eq 200
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      expect(Invite.find(invite.id).status).to eq(&#39;refused&#39;)
      expect(EventSerializer.new(invite.event).response[:participants].count).to eq(1)
    end
    it &#39;non existent invite&#39; do
      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      get &quot;v1/invites/#{rand(1.10000)}/refuse&quot;

      expect(last_response.status).to eq 404
    end
  end

  context &#39;PUT /v1/invites/:token/perhaps&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 2 nodes</span>              <span>Locations:</span>                  <a href="invites_api_spec.html#L393" class="js-smell-location">0</a>                  <a href="invites_api_spec.html#L447" class="js-smell-location">1</a>                  </div>  </li></ol>
    it &#39;perhaps in the future accept invite (perhaps)&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(PUT /v1/invites/:token/perhaps)::it(perhaps in the future accept invite (perhaps))#perhaps in the future accept invite (perhaps) has a flog score of 46</span>          </div>  </li></ol>
      sender = create(:user)
      invite = create(:invite, receiver_id: user.id, sender_id: sender.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      put &quot;/v1/invites/#{invite.token}/perhaps&quot;

      expect(last_response.status).to eq 200
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      expect(Invite.find(invite.id).status).to eq(&#39;perhaps&#39;)
    end

    it &quot;can&#39;t put perhaps on invite if event day already passed&quot; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(PUT /v1/invites/:token/perhaps)::it#can't put perhaps on invite if event day already passed has a flog score of 68</span>          </div>  </li></ol>
      sender = create(:user)
      event = create(:event, owner_id: sender.id, start_date: 2.days.ago, end_date: 1.day.ago)
      invite = create(:invite, event_id: event.id, sender_id: sender.id, receiver_id: user.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      put &quot;/v1/invites/#{invite.token}/perhaps&quot;

      expect(last_response.status).to eq 400
      expect(last_response.content_type).to include(&#39;application/json&#39;)
      expect(Invite.last.status).to eq(&#39;unanswered&#39;)

      parsed_body = JSON.parse(last_response.body)

      expect(parsed_body[&#39;error&#39;]).to eq(&#39;Event day already passed&#39;)
    end

    it &#39;possible change status after already had one&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(PUT /v1/invites/:token/perhaps)::it#possible change status after already had one has a flog score of 69</span>          </div>  </li></ol>
      sender = create(:user)
      invite = create(:invite, receiver_id: user.id, sender_id: sender.id, status: 1)

      expect(invite.status).to eq(&#39;accepted&#39;)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      put &quot;/v1/invites/#{invite.token}/perhaps&quot;

      expect(last_response.status).to eq 200
      expect(last_response.content_type).to include(&#39;application/json&#39;)

      expect(Invite.find(invite.id).status).to eq(&#39;perhaps&#39;)
      expect(EventSerializer.new(invite.event).response[:participants].count).to eq(1)
    end
    it &#39;non existent invite&#39; do
      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      put &quot;v1/invites/#{rand(1.10000)}/perhaps&quot;

      expect(last_response.status).to eq 404
    end
  end

  context &#39;DELETE /v1/invites/:token&#39; do
    it &#39;successufuly delete an invite&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>describe(Invite API)::context(DELETE /v1/invites/:token)::it#successufuly delete an invite has a flog score of 32</span>          </div>  </li></ol>
      receiver = create(:user)
      invite = create(:invite, receiver_id: receiver.id, sender_id: user.id)

      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      delete &quot;/v1/invites/#{invite.token}&quot;

      expect(last_response.status).to eq 204
      expect(Invite.all).to eq([])
    end

    it &#39;non existent invite&#39; do<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flay/" target="_blank"><b>DuplicateCode</b></a>        </span>      </div>      <span>Similar code found in 3 nodes</span>              <span>Locations:</span>                  <a href="events_api_spec.html#L65" class="js-smell-location">0</a>                  <a href="invites_api_spec.html#L94" class="js-smell-location">1</a>                  <a href="invites_api_spec.html#L513" class="js-smell-location">2</a>                  </div>  </li></ol>
      header &#39;Authorization&#39;, &quot;Bearer #{token(user)}&quot;
      delete &quot;v1/invites/#{rand(1.10000)}&quot;

      expect(last_response.status).to eq 404
    end
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- JavaScripts -->
    <script src="../../assets/vendor/javascripts/jquery.min.js"></script>
    <script src="../../assets/vendor/javascripts/jquery.tablesorter.min.js"></script>
    <script src="../../assets/vendor/javascripts/jquery.scrollTo.min.js"></script>
    <script src="../../assets/vendor/javascripts/jquery.timeago.js"></script>
    <script src="../../assets/vendor/javascripts/highcharts.src-4.0.1.js"></script>
    <script src="../../assets/vendor/javascripts/prettify.js"></script>
    <script src="../../assets/vendor/javascripts/bootstrap.min.js"></script>
    <script src="../../assets/javascripts/application.js"></script>
    <script src="../../assets/vendor/javascripts/jquery.filtertable.min.js"></script>
  </body>
</html>
